<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆ˜ìˆ  ì „ ìœ„í—˜ë„ í‰ê°€ ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .main-content {
            padding: 40px;
        }

        .search-container {
            margin-bottom: 30px;
        }

        .search-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .category-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .category-card.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .category-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .category-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .category-desc {
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.5;
        }

        .subcategory-panel {
            display: none;
            background: #f1f3f4;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            animation: slideDown 0.3s ease;
        }

        .subcategory-panel.show {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .subcategory-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 25px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .subcategory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .risk-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .risk-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .risk-item.selected {
            border-color: #28a745;
            background: #d4edda;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .custom-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #667eea;
            border-radius: 4px;
            position: relative;
            cursor: pointer;
            flex-shrink: 0;
        }

        .custom-checkbox.checked {
            background: #28a745;
            border-color: #28a745;
        }

        .custom-checkbox.checked::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 12px;
        }

        .risk-label {
            font-weight: 500;
            flex-grow: 1;
        }

        .detail-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
            display: none;
        }

        .detail-input.show {
            display: block;
        }

        .risk-summary {
            background: linear-gradient(135deg, #ff7675, #fd79a8);
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 40px;
            text-align: center;
            display: none;
        }

        .risk-summary.show {
            display: block;
        }

        .risk-level {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .btn {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .btn-reset {
            background: linear-gradient(135deg, #fd79a8, #ff7675);
        }

        .result-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            display: none;
        }

        .result-panel.show {
            display: block;
        }

        .consent-text {
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥ ìˆ˜ìˆ  ì „ ìœ„í—˜ë„ í‰ê°€ ì‹œìŠ¤í…œ</h1>
            <p>ì²´ê³„ì ì¸ ìˆ˜ìˆ  ì „ ìœ„í—˜ ìš”ì†Œ í‰ê°€ ë° ë™ì˜ì„œ ìƒì„±</p>
            <button class="btn btn-reset" onclick="resetAll()">ğŸ”„ ì „ì²´ ì´ˆê¸°í™”</button>
        </div>

        <div class="main-content">
            <div class="search-container">
                <input type="text" class="search-input" placeholder="ìœ„í—˜ ìš”ì†Œ ê²€ìƒ‰..." onkeyup="searchRisks(this.value)">
            </div>

            <div class="category-grid">
                <div class="category-card" onclick="showCategory('cardiovascular', this)">
                    <span class="category-icon">â¤ï¸</span>
                    <div class="category-title">ì‹¬ì¥ê³„</div>
                    <div class="category-desc">ì‹¬í˜ˆê´€ ì§ˆí™˜, ë¶€ì •ë§¥, ê³ í˜ˆì•• ë“±</div>
                </div>

                <div class="category-card" onclick="showCategory('respiratory', this)">
                    <span class="category-icon">ğŸ«</span>
                    <div class="category-title">í˜¸í¡ê¸°ê³„</div>
                    <div class="category-desc">ì²œì‹, COPD, ê²°í•µ, íë ´ ë“±</div>
                </div>

                <div class="category-card" onclick="showCategory('endocrine', this)">
                    <span class="category-icon">ğŸ§¬</span>
                    <div class="category-title">ë‚´ë¶„ë¹„ê³„</div>
                    <div class="category-desc">ë‹¹ë‡¨ë³‘, ê°‘ìƒì„  ì§ˆí™˜, ë¶€ì‹  ì§ˆí™˜ ë“±</div>
                </div>

                <div class="category-card" onclick="showCategory('hepatic', this)">
                    <span class="category-icon">ğŸ«˜</span>
                    <div class="category-title">ê°„ì¥ê³„</div>
                    <div class="category-desc">ê°„ê²½í™”, ê°„ì—¼, ê°„ê¸°ëŠ¥ ì¥ì•  ë“±</div>
                </div>

                <div class="category-card" onclick="showCategory('renal', this)">
                    <span class="category-icon">ğŸ«˜</span>
                    <div class="category-title">ì‹ ì¥ê³„</div>
                    <div class="category-desc">ì‹ ë¶€ì „, íˆ¬ì„, ì „í•´ì§ˆ ë¶ˆê· í˜• ë“±</div>
                </div>

                <div class="category-card" onclick="showCategory('neurologic', this)">
                    <span class="category-icon">ğŸ§ </span>
                    <div class="category-title">ì‹ ê²½ê³„</div>
                    <div class="category-desc">ë‡Œì¡¸ì¤‘, ì¤‘ì¦ê·¼ë¬´ë ¥ì¦, ì²™ì¶” ì§ˆí™˜ ë“±</div>
                </div>

                <div class="category-card" onclick="showCategory('hematologic', this)">
                    <span class="category-icon">ğŸ©¸</span>
                    <div class="category-title">í˜ˆì•¡ê³„</div>
                    <div class="category-desc">ë¹ˆí˜ˆ, ì‘ê³ ì¥ì• , ì¶œí˜ˆ ê²½í–¥ ë“±</div>
                </div>

                <div class="category-card" onclick="showCategory('infectious', this)">
                    <span class="category-icon">ğŸ¦ </span>
                    <div class="category-title">ê°ì—¼</div>
                    <div class="category-desc">COVID-19, ë°œì—´, í™œë™ì„± ê°ì—¼ ë“±</div>
                </div>

                <div class="category-card" onclick="showCategory('special', this)">
                    <span class="category-icon">âš ï¸</span>
                    <div class="category-title">íŠ¹ìˆ˜ìƒí™©</div>
                    <div class="category-desc">ê³ ë ¹, ë¹„ë§Œ, ì„ì‹ , ì‘ê¸‰ìˆ˜ìˆ  ë“±</div>
                </div>
            </div>

            <!-- ì‹¬ì¥ê³„ -->
            <div class="subcategory-panel" id="cardiovascular-panel">
                <div class="subcategory-title">â¤ï¸ ì‹¬ì¥ê³„ ìœ„í—˜ ìš”ì†Œ</div>
                <div class="subcategory-grid">
                    <div class="risk-item" onclick="toggleRisk('valve-disease', this)">
                        <div class="checkbox-wrapper">
                            <div class="custom-checkbox"></div>
                            <span class="risk-label">íŒë§‰ì§ˆí™˜</span>
                        </div>
                        <select class="detail-input" onclick="event.stopPropagation()">
                            <option value="">ì¢…ë¥˜ ì„ íƒ</option>
                            <option value="mitral-stenosis">ìŠ¹ëª¨íŒ í˜‘ì°©</option>
                            <option value="mitral-regurgitation">ìŠ¹ëª¨íŒ ì—­ë¥˜</option>
                            <option value="aortic-stenosis">ëŒ€ë™ë§¥íŒ í˜‘ì°©</option>
                            <option value="aortic-regurgitation">ëŒ€ë™ë§¥íŒ ì—­ë¥˜</option>
                        </select>
                    </div>

                    <div class="risk-item" onclick="toggleRisk('coronary-disease', this)">
                        <div class="checkbox-wrapper">
                            <div class="custom-checkbox"></div>
                            <span class="risk-label">ê´€ìƒë™ë§¥ì§ˆí™˜</span>
                        </div>
                        <select class="detail-input" onclick="event.stopPropagation()">
                            <option value="">ì¢…ë¥˜ ì„ íƒ</option>
                            <option value="stable-angina">ì•ˆì •ì„± í˜‘ì‹¬ì¦</option>
                            <option value="unstable-angina">ë¶ˆì•ˆì •ì„± í˜‘ì‹¬ì¦</option>
                            <option value="old-mi">ê³¼ê±° ì‹¬ê·¼ê²½ìƒ‰</option>
                            <option value="recent-pci">ìµœê·¼ PCI ì‹œí–‰</option>
                        </select>
                    </div>

                    <div class="risk-item" onclick="toggleRisk('arrhythmia', this)">
                        <div class="checkbox-wrapper">
                            <div class="custom-checkbox"></div>
                            <span class="risk-label">ë¶€ì •ë§¥</span>
                        </div>
                        <select class="detail-input" onclick="event.stopPropagation()">
                            <option value="">ì¢…ë¥˜ ì„ íƒ</option>
                            <option value="atrial-fib">ì‹¬ë°©ì„¸ë™</option>
                            <option value="vtach">ì‹¬ì‹¤ë¹ˆë§¥</option>
                            <option value="bradycardia">ì„œë§¥</option>
                            <option value="pacemaker">ì‹¬ë°•ì¡°ìœ¨ê¸°</option>
                        </select>
                    </div>

                    <div class="risk-item" onclick="toggleRisk('heart-failure', this)">
                        <div class="checkbox-wrapper">
                            <div class="custom-checkbox"></div>
                            <span class="risk-label">ì‹¬ë¶€ì „</span>
                        </div>
                        <input type="text" class="detail-input" placeholder="EF ê°’, NYHA class ì…ë ¥" onclick="event.stopPropagation()">
                    </div>

                    <div class="risk-item" onclick="toggleRisk('hypertension', this)">
                        <div class="checkbox-wrapper">
                            <div class="custom-checkbox"></div>
                            <span class="risk-label">ê³ í˜ˆì••</span>
                        </div>
                        <input type="text" class="detail-input" placeholder="í˜ˆì•• ìˆ˜ì¹˜, ë³µìš© ì•½ë¬¼ ì…ë ¥" onclick="event.stopPropagation()">
                    </div>

                    <div class="risk-item" onclick="toggleRisk('old-age-cardio', this)">
                        <div class="checkbox-wrapper">
                            <div class="custom-checkbox"></div>
                            <span class="risk-label">ê³ ë ¹ (ì‹¬í˜ˆê´€ ìœ„í—˜)</span>
                        </div>
                        <input type="text" class="detail-input" placeholder="ë‚˜ì´, functional activity ì…ë ¥" onclick="event.stopPropagation()">
                    </div>
                </div>
            </div>

            <!-- í˜¸í¡ê¸°ê³„ -->
            <div class="subcategory-panel" id="respiratory-panel">
                <div class="subcategory-title">ğŸ« í˜¸í¡ê¸°ê³„ ìœ„í—˜ ìš”ì†Œ</div>
                <div class="subcategory-grid">
                    <div class="risk-item" onclick="toggleRisk('asthma', this)">
                        <div class="checkbox-wrapper">
                            <div class="custom-checkbox"></div>
                            <span class="risk-label">ì²œì‹</span>
                        </div>
                        <input type="text" class="detail-input" placeholder="ë§ˆì§€ë§‰ ë°œì‘ ì‹œê¸°, ì¡°ì ˆ ìƒíƒœ ì…ë ¥" onclick="event.stopPropagation()">
                    </div>

                    <div class="risk-item" onclick="toggleRisk('copd', this)">
                        <div class="checkbox-wrapper">
                            <div class="custom-checkbox"></div>
                            <span class="risk-label">COPD</span>
                        </div>
                        <input type="text" class="detail-input" placeholder="ì¤‘ì¦ë„, PFT ê²°ê³¼ ì…ë ¥" onclick="event.stopPropagation()">
                    </div>

                    <div class="risk-item" onclick="toggleRisk('tuberculosis', this)">
                        <div class="checkbox-wrapper">
                            <div class="custom-checkbox"></div>
                            <span class="risk-label">ê²°í•µ</span>
                        </div>
                        <select class="detail-input" onclick="event.stopPropagation()">
                            <option value="">ìƒíƒœ ì„ íƒ</option>
                            <option value="active">í™œë™ì„± ê²°í•µ</option>
                            <option value="suspected">ê²°í•µ ì˜ì‹¬</option>
                            <option value="old">ê³¼ê±° ê²°í•µ</option>
                        </select>
                    </div>

                    <div class="risk-item" onclick="toggleRisk('sleep-apnea', this)">
                        <div class="checkbox-wrapper">
                            <div class="custom-checkbox"></div>
                            <span class="risk-label">ìˆ˜ë©´ë¬´í˜¸í¡ì¦</span>
                        </div>
                        <input type="text" class="detail-input" placeholder="AHI ì§€ìˆ˜, CPAP ì‚¬ìš© ì—¬ë¶€ ì…ë ¥" onclick="event.stopPropagation()">
                    </div>
                </div>
            </div>

            <!-- ë‚˜ë¨¸ì§€ íŒ¨ë„ë“¤ë„ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ê³„ì†... -->

            <div class="risk-summary" id="riskSummary">
                <div class="risk-level">ìœ„í—˜ë„: <span id="riskLevel">ì¤‘ë“±ë„</span></div>
                <div>ì„ íƒëœ ìœ„í—˜ ìš”ì†Œ: <span id="selectedCount">0</span>ê°œ</div>
                <button class="btn" onclick="generateConsentForm()">ë™ì˜ì„œ ìƒì„±</button>
            </div>

            <div class="result-panel" id="resultPanel">
                <h3>ğŸ¥ ìˆ˜ìˆ  ì „ ìœ„í—˜ë„ í‰ê°€ ê²°ê³¼ ë° ë™ì˜ì„œ</h3>
                <div class="consent-text" id="consentText"></div>
                <button class="btn" onclick="copyToClipboard()">ğŸ“‹ í´ë¦½ë³´ë“œ ë³µì‚¬</button>
                <button class="btn" onclick="printResult()">ğŸ–¨ï¸ ì¸ì‡„</button>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜ì™€ í•¨ìˆ˜ë“¤ì„ ë¨¼ì € ì •ì˜
        var selectedRisks = new Set();
        
        var riskTemplates = {
            'valve-disease': 'Peri-op cardiovascular cx.(malignant arrhythmia, Myocardial Infarction, Heart Failure, Sudden Cardiac Death ë“±) ë°œìƒ ê°€ëŠ¥ì„± ë° ì´ë¡œ ì¸í•œ ICU/Ventilator care ê°€ëŠ¥ì„±ì— ëŒ€í•´ ì¸ì§€ë™ì˜ì„œ ì‹œí–‰í•˜ì„¸ìš”.',
            'coronary-disease': 'peri-postop cardiovascular cx(MI, IHD, CHF, mailig. arrhythmia, sudden cardiac arrest) ë°œìƒê°€ëŠ¥ì„±ì— ëŒ€í•´ ì¸ì§€ë™ì˜ì„œ ì‹œí–‰í•˜ì„¸ìš”.',
            'arrhythmia': 'Peri-op cardiovascular cx.(malignant arrhythmia, Myocardial Infarction, Heart Failure, Sudden Cardiac Death ë“±) ë°œìƒ ê°€ëŠ¥ì„± ë° ì´ë¡œ ì¸í•œ ICU/Ventilator care ê°€ëŠ¥ì„±ì— ëŒ€í•´ ì¸ì§€ë™ì˜ì„œ ì‹œí–‰í•˜ì„¸ìš”.',
            'heart-failure': 'Peri-op cardiovascular cx.(malignant arrhythmia, Myocardial Infarction, Heart Failure, Sudden Cardiac Death ë“±) ë°œìƒ ê°€ëŠ¥ì„± ë° ì´ë¡œ ì¸í•œ ICU/Ventilator care ê°€ëŠ¥ì„±ì— ëŒ€í•´ ì¸ì§€ë™ì˜ì„œ ì‹œí–‰í•˜ì„¸ìš”.',
            'hypertension': 'BP < 140/90ìœ¼ë¡œ ì¡°ì ˆí•˜ì„¸ìš”. ORì—ì„œ BP ì¡°ì ˆ ì•ˆë ì‹œ ìˆ˜ìˆ ì§€ì—°ê°€ëŠ¥ì„±ì— ëŒ€í•´ ì„¤ëª…í•˜ì„¸ìš”.',
            'old-age-cardio': 'Old ageë¡œ ì¸í•œ peri-op cardio-pulmonary complications ë°œìƒ ê°€ëŠ¥ì„±ì— ëŒ€í•´ ì¸ì§€ë™ì˜ì„œ ì‹œí–‰í•˜ì„¸ìš”.',
            'asthma': 'peri-postop respiratory cx.(asthma or COPD attack, atelectasis, pneumonia, pul.edema, respi. failure) ë°œìƒ ê°€ëŠ¥ì„± ë° ì´ë¡œ ì¸í•œ ICU/ventilator care ê°€ëŠ¥ì„±ì— ëŒ€í•´ ì¸ì§€ë™ì˜ì„œ ì‹œí–‰í•˜ì„¸ìš”.',
            'copd': 'peri-postop respiratory cx.(asthma or COPD attack, atelectasis, pneumonia, pul.edema, respi. failure) ë°œìƒ ê°€ëŠ¥ì„± ë° ì´ë¡œ ì¸í•œ ICU/ventilator care ê°€ëŠ¥ì„±ì— ëŒ€í•´ ì¸ì§€ë™ì˜ì„œ ì‹œí–‰í•˜ì„¸ìš”.',
            'tuberculosis': 'Peri-op respiratory cx.(atelectasis, pneumonia,pul.edemaë“±) ë°œìƒ ê°€ëŠ¥ì„± ë° ì´ë¡œ ì¸í•œ ICU/Ventilator care ê°€ëŠ¥ì„±ì— ëŒ€í•´ ì¸ì§€ë™ì˜ì„œ ì‹œí–‰í•˜ì„¸ìš”.',
            'sleep-apnea': 'peri-postop respiratory cx.(asthma or COPD attack, atelectasis, pneumonia, pul.edema, respi. failure) ë°œìƒ ê°€ëŠ¥ì„± ë° ì´ë¡œ ì¸í•œ ICU/ventilator care ê°€ëŠ¥ì„±ì— ëŒ€í•´ ì¸ì§€ë™ì˜ì„œ ì‹œí–‰í•˜ì„¸ìš”.'
        };

        function showCategory(category, element) {
            console.log('ì¹´í…Œê³ ë¦¬ ì„ íƒ:', category);
            
            var cards = document.querySelectorAll('.category-card');
            for (var i = 0; i < cards.length; i++) {
                cards[i].classList.remove('active');
            }
            
            var panels = document.querySelectorAll('.subcategory-panel');
            for (var i = 0; i < panels.length; i++) {
                panels[i].classList.remove('show');
            }
            
            element.classList.add('active');
            
            var panel = document.getElementById(category + '-panel');
            if (panel) {
                panel.classList.add('show');
            }
        }

        function toggleRisk(riskId, element) {
            console.log('ìœ„í—˜ ìš”ì†Œ í† ê¸€:', riskId);
            
            var checkbox = element.querySelector('.custom-checkbox');
            var detailInput = element.querySelector('.detail-input');
            
            if (checkbox.classList.contains('checked')) {
                checkbox.classList.remove('checked');
                element.classList.remove('selected');
                if (detailInput) {
                    detailInput.classList.remove('show');
                }
                selectedRisks.delete(riskId);
            } else {
                checkbox.classList.add('checked');
                element.classList.add('selected');
                if (detailInput) {
                    detailInput.classList.add('show');
                }
                selectedRisks.add(riskId);
            }
            
            updateRiskSummary();
        }

        function updateRiskSummary() {
            var summary = document.getElementById('riskSummary');
            var count = document.getElementById('selectedCount');
            var level = document.getElementById('riskLevel');
            
            var riskCount = selectedRisks.size;
            count.textContent = riskCount;
            
            if (riskCount === 0) {
                summary.classList.remove('show');
            } else {
                summary.classList.add('show');
                
                if (riskCount <= 2) {
                    level.textContent = 'ì €ìœ„í—˜';
                    summary.style.background = 'linear-gradient(135deg, #00b894, #00cec9)';
                } else if (riskCount <= 5) {
                    level.textContent = 'ì¤‘ë“±ë„ ìœ„í—˜';
                    summary.style.background = 'linear-gradient(135deg, #fdcb6e, #e17055)';
                } else {
                    level.textContent = 'ê³ ìœ„í—˜';
                    summary.style.background = 'linear-gradient(135deg, #ff7675, #fd79a8)';
                }
            }
        }

        function searchRisks(searchTerm) {
            var term = searchTerm.toLowerCase();
            var items = document.querySelectorAll('.risk-item');
            
            for (var i = 0; i < items.length; i++) {
                var item = items[i];
                var text = item.textContent.toLowerCase();
                var panel = item.closest('.subcategory-panel');
                
                if (term === '' || text.includes(term)) {
                    item.style.display = 'block';
                    if (term !== '') {
                        panel.classList.add('show');
                    }
                } else {
                    item.style.display = 'none';
                }
            }
            
            if (term === '') {
                var panels = document.querySelectorAll('.subcategory-panel');
                for (var i = 0; i < panels.length; i++) {
                    panels[i].classList.remove('show');
                }
                var cards = document.querySelectorAll('.category-card');
                for (var i = 0; i < cards.length; i++) {
                    cards[i].classList.remove('active');
                }
            }
        }

        function generateConsentForm() {
            var content = '=== ìˆ˜ìˆ  ì „ ìœ„í—˜ë„ í‰ê°€ ê²°ê³¼ ===\n\n';
            content += 'í‰ê°€ì¼ì‹œ: ' + new Date().toLocaleString('ko-KR') + '\n';
            content += 'ì„ íƒëœ ìœ„í—˜ ìš”ì†Œ: ' + selectedRisks.size + 'ê°œ\n';
            var currentRiskLevel = document.getElementById('riskLevel').textContent;
            content += 'ìœ„í—˜ë„: ' + currentRiskLevel + '\n\n';
            content += '=== ìœ„í—˜ ìš”ì†Œë³„ ë™ì˜ì„œ ë‚´ìš© ===\n\n';
            
            var index = 1;
            selectedRisks.forEach(function(risk) {
                var items = document.querySelectorAll('.risk-item');
                for (var i = 0; i < items.length; i++) {
                    var item = items[i];
                    var onclick = item.getAttribute('onclick');
                    if (onclick && onclick.includes(risk)) {
                        var label = item.querySelector('.risk-label').textContent;
                        var input = item.querySelector('.detail-input');
                        
                        content += index + '. ' + label + '\n';
                        
                        if (input && input.classList.contains('show') && input.value) {
                            if (input.tagName === 'SELECT') {
                                var option = input.options[input.selectedIndex];
                                if (option.value) {
                                    content += '   ì„¸ë¶€ì‚¬í•­: ' + option.text + '\n';
                                }
                            } else {
                                content += '   ì„¸ë¶€ì‚¬í•­: ' + input.value + '\n';
                            }
                        }
                        
                        var template = riskTemplates[risk] || 'í•´ë‹¹ ìœ„í—˜ ìš”ì†Œì— ëŒ€í•œ ì ì ˆí•œ ì„¤ëª…ê³¼ ë™ì˜ì„œë¥¼ ì¤€ë¹„í•˜ì„¸ìš”.';
                        content += '   ' + template + '\n\n';
                        
                        index++;
                        break;
                    }
                }
            });
            
            if (currentRiskLevel === 'ì¤‘ë“±ë„ ìœ„í—˜' || currentRiskLevel === 'ê³ ìœ„í—˜') {
                content += '\n=== ì¶”ê°€ ìœ„í—˜ë„ ì•ˆë‚´ ===\n\n';
                content += 'âš ï¸ í˜„ì¬ í™˜ìì˜ ìœ„í—˜ë„ê°€ ' + currentRiskLevel + 'ë¡œ í‰ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n';
                content += 'ë‹¤ìŒ ì‚¬í•­ì— ëŒ€í•´ ì¶”ê°€ë¡œ ì¸ì§€ë™ì˜ì„œë¥¼ ë°›ì•„ì£¼ì„¸ìš”:\n\n';
                content += 'â€¢ ìˆ˜ìˆ  ë° ë§ˆì·¨ í•©ë³‘ì¦ ìœ„í—˜ì„±ì´ ì¼ë°˜ í™˜ìì— ë¹„í•´ ë†’ìŠµë‹ˆë‹¤.\n';
                content += 'â€¢ ìˆ˜ìˆ  ì¤‘ ë˜ëŠ” ìˆ˜ìˆ  í›„ ì˜ˆìƒì¹˜ ëª»í•œ í•©ë³‘ì¦ ë°œìƒ ê°€ëŠ¥ì„±ì´ ì¦ê°€í•©ë‹ˆë‹¤.\n';
                content += 'â€¢ ì¤‘í™˜ìì‹¤ ì¹˜ë£Œë‚˜ ì¸ê³µí˜¸í¡ê¸° ì¹˜ë£Œê°€ í•„ìš”í•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.\n';
                content += 'â€¢ ìˆ˜ìˆ  ì—°ê¸°ë‚˜ ì·¨ì†Œê°€ í•„ìš”í•  ìˆ˜ ìˆìœ¼ë©°, ì‘ê¸‰ìƒí™© ë°œìƒ ì‹œ ì¦‰ê°ì ì¸ ì²˜ì¹˜ê°€ ì‹œí–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n';
                content += 'â€¢ íšŒë³µ ê¸°ê°„ì´ ì—°ì¥ë  ìˆ˜ ìˆìœ¼ë©°, ì¶”ê°€ì ì¸ ì˜ë£Œ ì²˜ì¹˜ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n';
                content += 'â€¢ ìœ„í—˜ ìš”ì†Œë“¤ë¡œ ì¸í•´ ìˆ˜ìˆ  ì„±ê³µë¥ ì´ ê°ì†Œí•˜ê³  í•©ë³‘ì¦ ë°œìƒë¥ ì´ ì¦ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n';
                content += 'ìœ„ ìœ„í—˜ì„±ì— ëŒ€í•´ ì¶©ë¶„íˆ ì´í•´í•˜ì˜€ìœ¼ë©°, ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  ìˆ˜ìˆ ì„ ì§„í–‰í•˜ëŠ” ê²ƒì— ë™ì˜í•©ë‹ˆë‹¤.\n\n';
            }
            
            content += '\n=== ì¼ë°˜ì ì¸ ìˆ˜ìˆ  ì „ ì£¼ì˜ì‚¬í•­ ===\n\n';
            content += 'â€¢ ìˆ˜ìˆ  ì „ ê¸ˆì‹ ì‹œê°„ì„ ì—„ê²©íˆ ì¤€ìˆ˜í•˜ì„¸ìš”.\n';
            content += 'â€¢ ë³µìš© ì¤‘ì¸ ëª¨ë“  ì•½ë¬¼ì— ëŒ€í•´ ì˜ë£Œì§„ê³¼ ìƒì˜í•˜ì„¸ìš”.\n';
            content += 'â€¢ ìˆ˜ìˆ  ë‹¹ì¼ ì²´ì˜¨, í˜ˆì••, ë§¥ë°• ë“± í™œë ¥ì§•í›„ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.\n';
            content += 'â€¢ ìˆ˜ìˆ  ì¤‘ ì˜ˆìƒì¹˜ ëª»í•œ í•©ë³‘ì¦ ë°œìƒ ì‹œ ì‘ê¸‰ì²˜ì¹˜ê°€ ì‹œí–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n';
            
            content += '=== í™˜ì/ë³´í˜¸ì ì„œëª… ===\n\n';
            content += 'í™˜ìëª…: ________________    ì„œëª…: ________________    ë‚ ì§œ: ________________\n';
            content += 'ë³´í˜¸ìëª…: ______________    ì„œëª…: ________________    ë‚ ì§œ: ________________\n';
            content += 'ì˜ë£Œì§„ëª…: ______________    ì„œëª…: ________________    ë‚ ì§œ: ________________\n';
            
            if (currentRiskLevel === 'ì¤‘ë“±ë„ ìœ„í—˜' || currentRiskLevel === 'ê³ ìœ„í—˜') {
                content += '\n=== ê³ ìœ„í—˜ ìˆ˜ìˆ  ì¶”ê°€ ë™ì˜ ì„œëª… ===\n\n';
                content += 'ìœ„ ê³ ìœ„í—˜ ìˆ˜ìˆ  ê´€ë ¨ í•©ë³‘ì¦ ë° ìœ„í—˜ì„±ì— ëŒ€í•´ ì¶©ë¶„íˆ ì„¤ëª…ë°›ê³  ì´í•´í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n';
                content += 'í™˜ìëª…: ________________    ì„œëª…: ________________    ë‚ ì§œ: ________________\n';
                content += 'ë³´í˜¸ìëª…: ______________    ì„œëª…: ________________    ë‚ ì§œ: ________________\n';
                content += 'ì„¤ëª…ì˜ì‚¬ëª…: ____________    ì„œëª…: ________________    ë‚ ì§œ: ________________\n';
            }
            
            document.getElementById('consentText').textContent = content;
            document.getElementById('resultPanel').classList.add('show');
            document.getElementById('resultPanel').scrollIntoView({ behavior: 'smooth' });
        }

        function copyToClipboard() {
            var text = document.getElementById('consentText').textContent;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(function() {
                    alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                });
            } else {
                var textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        function printResult() {
            var text = document.getElementById('consentText').textContent;
            var win = window.open('', '_blank');
            win.document.write('<html><head><title>ìˆ˜ìˆ  ì „ ìœ„í—˜ë„ í‰ê°€</title><style>body{font-family:monospace;margin:20px;line-height:1.6;}</style></head><body><pre>' + text + '</pre></body></html>');
            win.document.close();
            win.print();
        }

        function resetAll() {
            console.log('ì „ì²´ ì´ˆê¸°í™”');
            
            var checkboxes = document.querySelectorAll('.custom-checkbox');
            for (var i = 0; i < checkboxes.length; i++) {
                checkboxes[i].classList.remove('checked');
            }
            
            var items = document.querySelectorAll('.risk-item');
            for (var i = 0; i < items.length; i++) {
                items[i].classList.remove('selected');
                var input = items[i].querySelector('.detail-input');
                if (input) {
                    input.classList.remove('show');
                    input.value = '';
                }
            }
            
            var cards = document.querySelectorAll('.category-card');
            for (var i = 0; i < cards.length; i++) {
                cards[i].classList.remove('active');
            }
            
            var panels = document.querySelectorAll('.subcategory-panel');
            for (var i = 0; i < panels.length; i++) {
                panels[i].classList.remove('show');
            }
            
            var searchInput = document.querySelector('.search-input');
            if (searchInput) {
                searchInput.value = '';
            }
            
            selectedRisks.clear();
            updateRiskSummary();
            
            document.getElementById('resultPanel').classList.remove('show');
        }
    </script>
